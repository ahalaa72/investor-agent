# Use Python 3.12 slim image as base
FROM python:3.12-slim

# Set working directory
WORKDIR /app

# Install system dependencies including TA-Lib
RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    wget \
    git \
    && rm -rf /var/lib/apt/lists/*

# Install TA-Lib C library
RUN wget http://prdownloads.sourceforge.net/ta-lib/ta-lib-0.4.0-src.tar.gz && \
    tar -xzf ta-lib-0.4.0-src.tar.gz && \
    cd ta-lib/ && \
    ./configure --prefix=/usr && \
    make && \
    make install && \
    cd .. && \
    rm -rf ta-lib ta-lib-0.4.0-src.tar.gz

# Install uv package manager
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:$PATH"

# Install all dependencies including TA-Lib
RUN /root/.local/bin/uv pip install --system \
    alpaca-py \
    "hishel>=0.1.3" \
    "html5lib>=1.1" \
    "httpx>=0.28.1" \
    "lxml>=6.0.1" \
    "mcp[cli]>=1.14.1" \
    "pandas>=2.3.2" \
    "pytrends>=4.9.2" \
    "requests-cache>=1.2.1" \
    "tenacity>=9.1.2" \
    "yfinance[nospam]>=0.2.66" \
    "ta-lib>=0.6.7"

# Copy only the investor_agent package
COPY investor_agent ./investor_agent

# Set environment variables
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# Keep container running - Claude Desktop will exec into it
CMD ["tail", "-f", "/dev/null"]
